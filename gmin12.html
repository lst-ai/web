

<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¶…ç´šåæ‡‰åŠ›æŒ‘æˆ°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, #4f46e5, #7c3aed, #ec4899);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .target {
            position: absolute;
            cursor: pointer;
            transition: transform 0.1s;
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
        }
        
        .target:hover {
            transform: scale(1.05);
        }
        
        .target-circle {
            border-radius: 50%;
        }
        
        .target-square {
            border-radius: 8px;
        }
        
        .target-triangle {
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
        }
        
        .target-star {
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
        }
        
        .target-heart {
            clip-path: polygon(50% 0%, 100% 38%, 82% 100%, 50% 76%, 18% 100%, 0% 38%);
        }
        
        .pop-effect {
            animation: pop 0.3s ease-out;
        }
        
        @keyframes pop {
            0% { transform: scale(0.5); opacity: 0; }
            70% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .fade-out {
            animation: fadeOut 0.3s forwards;
        }
        
        @keyframes fadeOut {
            to { opacity: 0; transform: scale(1.5); }
        }
        
        .leaderboard-item {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .difficulty-btn.active {
            background-color: #4f46e5;
            color: white;
            box-shadow: 0 0 0 2px #c7d2fe;
            transform: translateY(-2px);
        }
        
        .mode-btn.active {
            background-color: #4f46e5;
            color: white;
            box-shadow: 0 0 0 2px #c7d2fe;
            transform: translateY(-2px);
        }
        
        .game-container {
            position: relative;
            overflow: hidden;
        }
        
        .combo-indicator {
            position: absolute;
            font-weight: bold;
            animation: comboAnim 0.8s ease-out forwards;
            z-index: 10;
            text-shadow: 0 0 5px rgba(255,255,255,0.8);
        }
        
        @keyframes comboAnim {
            0% { transform: scale(0.5); opacity: 0; }
            20% { transform: scale(1.5); opacity: 1; }
            80% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }
        
        .countdown {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 8rem;
            font-weight: bold;
            color: white;
            text-shadow: 0 0 20px rgba(0,0,0,0.5);
            animation: countdownAnim 1s ease-out;
        }
        
        @keyframes countdownAnim {
            0% { transform: translate(-50%, -50%) scale(2); opacity: 0; }
            20% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            80% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            z-index: 100;
        }
        
        .progress-bar {
            height: 10px;
            transition: width 0.1s linear;
            border-radius: 5px;
        }
        
        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }
        
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        
        .pulse {
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .achievement {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255,255,255,0.95);
            border-left: 5px solid #4f46e5;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            animation: slideInRight 0.5s ease-out forwards, slideOutRight 0.5s ease-in forwards 4s;
            max-width: 300px;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        .reset-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 100;
            transition: all 0.3s ease;
        }
        
        .reset-btn:hover {
            transform: rotate(180deg);
        }
        
        .btn-bounce {
            animation: btnBounce 1s infinite;
        }
        
        @keyframes btnBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        .copy-notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 14px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .copy-notification.show {
            opacity: 1;
        }
        
        .footer {
            background-color: rgba(255, 255, 255, 0.9);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            padding: 16px 0;
            margin-top: 24px;
            border-radius: 12px;
        }
        
        .copy-btn {
            background-color: #e0e7ff;
            color: #4f46e5;
            border-radius: 4px;
            padding: 2px 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: inherit;
            border: none;
        }
        
        .copy-btn:hover {
            background-color: #c7d2fe;
        }
        
        .copy-btn:active {
            transform: scale(0.95);
        }
        
        .copy-btn.copied {
            background-color: #10b981;
            color: white;
        }
        
        /* æ‰‹æ©Ÿæ¨¡å¼å„ªåŒ– */
        @media (max-width: 768px) {
            .game-container {
                height: 60vh !important; /* å¢åŠ æ‰‹æ©Ÿæ¨¡å¼ä¸‹çš„éŠæˆ²å€åŸŸé«˜åº¦ */
                min-height: 350px;
            }
            
            .countdown {
                font-size: 5rem; /* èª¿æ•´å€’æ•¸è¨ˆæ™‚å­—é«”å¤§å° */
            }
            
            #start-button {
                padding: 1rem 2rem;
                font-size: 1.25rem;
            }
            
            .difficulty-btn, .mode-btn {
                padding: 0.5rem 0.75rem;
                font-size: 0.9rem;
            }
            
            .target {
                /* ç¢ºä¿ç›®æ¨™åœ¨æ‰‹æ©Ÿä¸Šè¶³å¤ å¤§ */
                min-width: 50px;
                min-height: 50px;
            }
        }
    </style>
</head>
<body class="text-gray-800">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <div class="bg-white bg-opacity-95 rounded-2xl shadow-xl p-6 mb-8">
            <div class="flex items-center justify-center mb-4">
                <div class="text-center">
                    <h1 class="text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 via-purple-500 to-pink-500 mb-2">è¶…ç´šåæ‡‰åŠ›æŒ‘æˆ°</h1>
                    <p class="text-gray-600 mb-2">çœ¼æ˜æ‰‹å¿«ï¼é»æ“Šå‡ºç¾çš„ç›®æ¨™ï¼Œè¶Šå¿«è¶Šå¥½ï¼</p>
                </div>
            </div>
            
            <!-- éŠæˆ²ç‹€æ…‹ -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-6">
                <div class="bg-gradient-to-r from-indigo-500 to-purple-500 rounded-lg p-3 text-white">
                    <div class="flex justify-between items-center">
                        <p class="font-medium">å¹³å‡åæ‡‰æ™‚é–“</p>
                        <p class="font-bold text-xl"><span id="average-time">0</span> æ¯«ç§’</p>
                    </div>
                </div>
                <div class="bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg p-3 text-white">
                    <div class="flex justify-between items-center">
                        <p class="font-medium">é€£æ“Šæ•¸</p>
                        <p class="font-bold text-xl"><span id="combo-count">0</span> <span class="text-sm">æœ€é«˜: <span id="max-combo">0</span></span></p>
                    </div>
                </div>
                <div class="bg-gradient-to-r from-pink-500 to-rose-500 rounded-lg p-3 text-white">
                    <div class="flex justify-between items-center">
                        <p class="font-medium">å‰©é¤˜å›åˆ</p>
                        <p class="font-bold text-xl"><span id="rounds-left">15</span>/<span id="total-rounds">15</span></p>
                    </div>
                </div>
            </div>
            
            <!-- é›£åº¦é¸æ“‡ -->
            <div class="mb-6">
                <div class="flex flex-wrap justify-between items-center mb-3">
                    <p class="text-gray-700 font-medium">é›£åº¦é¸æ“‡:</p>
                    <div class="flex items-center">
                        <span class="text-sm text-gray-500 mr-2">æœ€ä½³æˆç¸¾: </span>
                        <span id="best-time" class="font-bold text-indigo-600">-</span>
                        <span class="text-sm text-gray-500 ml-1">æ¯«ç§’</span>
                    </div>
                </div>
                <div class="flex flex-wrap gap-2">
                    <button class="difficulty-btn active px-4 py-2 bg-indigo-100 hover:bg-indigo-200 rounded-lg transition" data-difficulty="easy">
                        <span class="flex items-center">ğŸ˜Š ç°¡å–®</span>
                    </button>
                    <button class="difficulty-btn px-4 py-2 bg-indigo-100 hover:bg-indigo-200 rounded-lg transition" data-difficulty="medium">
                        <span class="flex items-center">ğŸ˜ ä¸­ç­‰</span>
                    </button>
                    <button class="difficulty-btn px-4 py-2 bg-indigo-100 hover:bg-indigo-200 rounded-lg transition" data-difficulty="hard">
                        <span class="flex items-center">ğŸ”¥ å›°é›£</span>
                    </button>
                    <button class="difficulty-btn px-4 py-2 bg-indigo-100 hover:bg-indigo-200 rounded-lg transition" data-difficulty="insane">
                        <span class="flex items-center">ğŸ¤¯ ç˜‹ç‹‚</span>
                    </button>
                </div>
            </div>
            
            <!-- éŠæˆ²æ¨¡å¼ -->
            <div class="mb-6">
                <p class="text-gray-700 font-medium mb-3">éŠæˆ²æ¨¡å¼:</p>
                <div class="flex flex-wrap gap-2">
                    <button class="mode-btn active px-4 py-2 bg-indigo-100 hover:bg-indigo-200 rounded-lg transition" data-mode="standard">
                        <span class="flex items-center">ğŸ¯ æ¨™æº–æ¨¡å¼</span>
                    </button>
                    <button class="mode-btn px-4 py-2 bg-indigo-100 hover:bg-indigo-200 rounded-lg transition" data-mode="shapes">
                        <span class="flex items-center">ğŸ”¶ å½¢ç‹€æŒ‘æˆ°</span>
                    </button>
                    <button class="mode-btn px-4 py-2 bg-indigo-100 hover:bg-indigo-200 rounded-lg transition" data-mode="moving">
                        <span class="flex items-center">ğŸƒ ç§»å‹•ç›®æ¨™</span>
                    </button>
                </div>
            </div>
            
            <!-- éŠæˆ²å€åŸŸ - å¢åŠ æ‰‹æ©Ÿæ¨¡å¼ä¸‹çš„é«˜åº¦ -->
            <div id="game-area" class="game-container bg-gradient-to-br from-indigo-100 to-purple-100 rounded-2xl h-80 md:h-96 mb-6 relative">
                <!-- é‡ç½®æŒ‰éˆ• -->
                <button id="reset-button" class="reset-btn bg-white bg-opacity-90 p-2 rounded-full shadow-lg hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                </button>
                
                <div class="absolute inset-0 flex items-center justify-center">
                    <button id="start-button" class="bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-bold py-4 px-8 rounded-xl shadow-lg transition transform hover:scale-105 pulse text-xl">
                        é–‹å§‹éŠæˆ²
                    </button>
                </div>
                
                <!-- é€²åº¦æ¢ -->
                <div id="timer-bar-container" class="absolute bottom-0 left-0 right-0 px-4 pb-4 hidden">
                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                        <div id="timer-bar" class="progress-bar bg-gradient-to-r from-green-400 to-blue-500 w-full"></div>
                    </div>
                </div>
            </div>
            
            <!-- æ§åˆ¶æŒ‰éˆ• -->
            <div class="flex justify-center gap-4 mb-8">
                <button id="restart-button" class="bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-bold py-3 px-8 rounded-xl shadow transition hidden">
                    å†ç©ä¸€æ¬¡
                </button>
            </div>
            
            <!-- çµ±è¨ˆå’Œæ’è¡Œæ¦œ -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- çµ±è¨ˆ -->
                <div>
                    <h2 class="text-xl font-bold text-gray-800 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        ä½ çš„çµ±è¨ˆ
                    </h2>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="grid grid-cols-2 gap-3">
                            <div class="bg-white p-3 rounded-lg shadow-sm">
                                <p class="text-gray-500 text-sm">æœ€å¿«åæ‡‰</p>
                                <p id="stats-best" class="font-bold text-xl text-indigo-600">-</p>
                            </div>
                            <div class="bg-white p-3 rounded-lg shadow-sm">
                                <p class="text-gray-500 text-sm">æœ€é«˜é€£æ“Š</p>
                                <p id="stats-combo" class="font-bold text-xl text-purple-600">0</p>
                            </div>
                            <div class="bg-white p-3 rounded-lg shadow-sm">
                                <p class="text-gray-500 text-sm">ç¸½éŠæˆ²æ¬¡æ•¸</p>
                                <p id="stats-games" class="font-bold text-xl text-pink-600">0</p>
                            </div>
                            <div class="bg-white p-3 rounded-lg shadow-sm">
                                <p class="text-gray-500 text-sm">ç¸½é»æ“Šæ¬¡æ•¸</p>
                                <p id="stats-clicks" class="font-bold text-xl text-rose-600">0</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æ’è¡Œæ¦œ -->
                <div>
                    <h2 class="text-xl font-bold text-gray-800 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        æ’è¡Œæ¦œ
                    </h2>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div id="leaderboard" class="space-y-2">
                            <p class="text-gray-500 text-center">å°šç„¡è¨˜éŒ„</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ä½œè€…è³‡è¨Š -->
            <div class="footer mt-8">
                <div class="text-center text-gray-600">
                    <p class="mb-2">éŠæˆ²è¨­è¨ˆèˆ‡è£½ä½œï¼šå‘‚èˆ’å©·ï½œäº†è§£æ›´å¤šğŸ”</p>
                    <p class="mb-2">
                        Fbï¼š<span class="text-indigo-600">https://www.facebook.com/yobi.lu</span>
                        <button id="copy-button" class="copy-btn ml-1">è¤‡è£½</button>
                    </p>
                    <p>ğŸ“§ luuyobi@gmail.com</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- è¤‡è£½é€šçŸ¥ -->
    <div id="copy-notification" class="copy-notification">å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿</div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // éŠæˆ²è®Šæ•¸
            const gameArea = document.getElementById('game-area');
            const startButton = document.getElementById('start-button');
            const restartButton = document.getElementById('restart-button');
            const resetButton = document.getElementById('reset-button');
            const averageTimeDisplay = document.getElementById('average-time');
            const roundsLeftDisplay = document.getElementById('rounds-left');
            const totalRoundsDisplay = document.getElementById('total-rounds');
            const bestTimeDisplay = document.getElementById('best-time');
            const comboCountDisplay = document.getElementById('combo-count');
            const maxComboDisplay = document.getElementById('max-combo');
            const leaderboard = document.getElementById('leaderboard');
            const difficultyButtons = document.querySelectorAll('.difficulty-btn');
            const modeButtons = document.querySelectorAll('.mode-btn');
            const timerBarContainer = document.getElementById('timer-bar-container');
            const timerBar = document.getElementById('timer-bar');
            const statsBest = document.getElementById('stats-best');
            const statsCombo = document.getElementById('stats-combo');
            const statsGames = document.getElementById('stats-games');
            const statsClicks = document.getElementById('stats-clicks');
            const copyButton = document.getElementById('copy-button');
            const copyNotification = document.getElementById('copy-notification');
            
            let gameActive = false;
            let currentRound = 0;
            let totalRounds = 15;
            let reactionTimes = [];
            let targetAppearTime = 0;
            let currentTarget = null;
            let timeoutId = null;
            let difficulty = 'easy';
            let gameMode = 'standard';
            let leaderboardData = [];
            let comboCount = 0;
            let maxCombo = 0;
            let totalGames = 0;
            let totalClicks = 0;
            let bestReactionTime = Infinity;
            let targetTimeout = null;
            let movingInterval = null;
            let timerInterval = null;
            let achievements = {
                speedDemon: false,
                comboMaster: false,
                perfectGame: false
            };
            
            // è¤‡è£½æŒ‰éˆ•åŠŸèƒ½
            copyButton.addEventListener('click', function() {
                const fbLink = "https://www.facebook.com/yobi.lu";
                
                // ä½¿ç”¨ç¾ä»£å‰ªè²¼ç°¿API
                navigator.clipboard.writeText(fbLink).then(function() {
                    // æ›´æ”¹æŒ‰éˆ•æ–‡å­—
                    copyButton.textContent = 'å·²è¤‡è£½';
                    copyButton.classList.add('copied');
                    
                    // 2ç§’å¾Œæ¢å¾©åŸå§‹æ–‡å­—
                    setTimeout(function() {
                        copyButton.textContent = 'è¤‡è£½';
                        copyButton.classList.remove('copied');
                    }, 2000);
                }).catch(function(err) {
                    console.error('ç„¡æ³•è¤‡è£½æ–‡å­—: ', err);
                    
                    // å‚™ç”¨æ–¹æ³•ï¼šå‰µå»ºä¸€å€‹è‡¨æ™‚æ–‡æœ¬å€åŸŸ
                    const textArea = document.createElement('textarea');
                    textArea.value = fbLink;
                    textArea.style.position = 'fixed';
                    textArea.style.left = '-999999px';
                    textArea.style.top = '-999999px';
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    
                    try {
                        const successful = document.execCommand('copy');
                        if (successful) {
                            copyButton.textContent = 'å·²è¤‡è£½';
                            copyButton.classList.add('copied');
                            
                            setTimeout(function() {
                                copyButton.textContent = 'è¤‡è£½';
                                copyButton.classList.remove('copied');
                            }, 2000);
                        }
                    } catch (err) {
                        console.error('å‚™ç”¨è¤‡è£½æ–¹æ³•å¤±æ•—:', err);
                    }
                    
                    document.body.removeChild(textArea);
                });
            });
            
            // é›£åº¦è¨­å®š
            const difficultySettings = {
                easy: {
                    minDelay: 1000,
                    maxDelay: 3000,
                    minSize: 70,
                    maxSize: 90,
                    timeLimit: 2000,
                    colors: ['#ef4444', '#3b82f6', '#10b981', '#f59e0b', '#8b5cf6']
                },
                medium: {
                    minDelay: 800,
                    maxDelay: 2500,
                    minSize: 60,
                    maxSize: 80,
                    timeLimit: 1500,
                    colors: ['#ef4444', '#3b82f6', '#10b981', '#f59e0b', '#8b5cf6']
                },
                hard: {
                    minDelay: 600,
                    maxDelay: 2000,
                    minSize: 50,
                    maxSize: 70,
                    timeLimit: 1200,
                    colors: ['#ef4444', '#3b82f6', '#10b981', '#f59e0b', '#8b5cf6']
                },
                insane: {
                    minDelay: 400,
                    maxDelay: 1500,
                    minSize: 40,
                    maxSize: 60,
                    timeLimit: 1000,
                    colors: ['#ef4444', '#3b82f6', '#10b981', '#f59e0b', '#8b5cf6']
                }
            };
            
            // æ‰‹æ©Ÿæ¨¡å¼ä¸‹èª¿æ•´ç›®æ¨™å¤§å°
            if (window.innerWidth <= 768) {
                Object.keys(difficultySettings).forEach(key => {
                    difficultySettings[key].minSize += 10; // å¢åŠ æœ€å°å°ºå¯¸
                    difficultySettings[key].maxSize += 10; // å¢åŠ æœ€å¤§å°ºå¯¸
                });
            }
            
            // å½¢ç‹€é¡å‹
            const shapeTypes = ['target-circle', 'target-square', 'target-triangle', 'target-star', 'target-heart'];
            
            // è¨­å®šé›£åº¦æŒ‰éˆ•
            difficultyButtons.forEach(button => {
                button.addEventListener('click', () => {
                    if (!gameActive) {
                        difficultyButtons.forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');
                        difficulty = button.dataset.difficulty;
                    }
                });
            });
            
            // è¨­å®šæ¨¡å¼æŒ‰éˆ•
            modeButtons.forEach(button => {
                button.addEventListener('click', () => {
                    if (!gameActive) {
                        modeButtons.forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');
                        gameMode = button.dataset.mode;
                    }
                });
            });
            
            // é–‹å§‹éŠæˆ²
            startButton.addEventListener('click', startGame);
            restartButton.addEventListener('click', restartGame);
            resetButton.addEventListener('click', resetGame);
            
            // è¼‰å…¥çµ±è¨ˆè³‡æ–™
            loadStats();
            
            function startGame() {
                gameActive = true;
                currentRound = 0;
                reactionTimes = [];
                comboCount = 0;
                maxCombo = 0;
                
                averageTimeDisplay.textContent = '0';
                roundsLeftDisplay.textContent = totalRounds;
                totalRoundsDisplay.textContent = totalRounds;
                comboCountDisplay.textContent = '0';
                maxComboDisplay.textContent = '0';
                
                startButton.classList.add('hidden');
                restartButton.classList.add('hidden');
                resetButton.classList.remove('hidden');
                resetButton.classList.add('btn-bounce');
                timerBarContainer.classList.remove('hidden');
                
                // æ¸…ç©ºéŠæˆ²å€åŸŸ
                clearGameArea();
                
                // å€’æ•¸è¨ˆæ™‚
                showCountdown(() => {
                    createTarget();
                });
                
                // æ›´æ–°çµ±è¨ˆ
                totalGames++;
                statsGames.textContent = totalGames;
                saveStats();
            }
            
            // æ¸…ç©ºéŠæˆ²å€åŸŸçš„æ‰€æœ‰å…ƒç´ 
            function clearGameArea() {
                // æ¸…é™¤æ‰€æœ‰å¯èƒ½çš„éŠæˆ²å…ƒç´ 
                const elementsToRemove = gameArea.querySelectorAll('.target, .countdown, .combo-indicator, .confetti');
                elementsToRemove.forEach(el => {
                    if (el.parentNode === gameArea) {
                        gameArea.removeChild(el);
                    }
                });
                
                // æ¸…é™¤çµæœé¡¯ç¤º
                const resultEl = gameArea.querySelector('.absolute.inset-0.flex.items-center.justify-center.flex-col');
                if (resultEl) {
                    gameArea.removeChild(resultEl);
                }
                
                // æ¸…é™¤æ‰€æœ‰è¨ˆæ™‚å™¨
                if (timeoutId) clearTimeout(timeoutId);
                if (targetTimeout) clearTimeout(targetTimeout);
                if (movingInterval) clearInterval(movingInterval);
                if (timerInterval) clearInterval(timerInterval);
                
                // é‡ç½®ç•¶å‰ç›®æ¨™
                currentTarget = null;
            }
            
            function showCountdown(callback) {
                let count = 3;
                
                function showNumber() {
                    if (count > 0) {
                        const countdownEl = document.createElement('div');
                        countdownEl.className = 'countdown';
                        countdownEl.textContent = count;
                        gameArea.appendChild(countdownEl);
                        
                        setTimeout(() => {
                            if (countdownEl.parentNode === gameArea) {
                                gameArea.removeChild(countdownEl);
                            }
                            count--;
                            showNumber();
                        }, 1000);
                    } else {
                        const goEl = document.createElement('div');
                        goEl.className = 'countdown';
                        goEl.textContent = 'é–‹å§‹ï¼';
                        goEl.style.fontSize = '5rem';
                        gameArea.appendChild(goEl);
                        
                        setTimeout(() => {
                            if (goEl.parentNode === gameArea) {
                                gameArea.removeChild(goEl);
                            }
                            callback();
                        }, 1000);
                    }
                }
                
                showNumber();
            }
            
            function restartGame() {
                cleanupGame();
                startGame();
            }
            
            function resetGame() {
                // é¡¯ç¤ºç¢ºèªå°è©±æ¡†
                const confirmEl = document.createElement('div');
                confirmEl.className = 'absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50 rounded-2xl';
                confirmEl.innerHTML = `
                    <div class="bg-white p-5 rounded-xl shadow-lg max-w-xs w-full">
                        <h3 class="text-lg font-bold text-gray-800 mb-3">ç¢ºå®šè¦é‡ç½®éŠæˆ²ï¼Ÿ</h3>
                        <p class="text-gray-600 mb-4">ç•¶å‰é€²åº¦å°‡ä¸æœƒè¢«ä¿å­˜ã€‚</p>
                        <div class="flex justify-end gap-3">
                            <button id="cancel-reset" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg transition">å–æ¶ˆ</button>
                            <button id="confirm-reset" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition">ç¢ºå®š</button>
                        </div>
                    </div>
                `;
                
                gameArea.appendChild(confirmEl);
                
                document.getElementById('cancel-reset').addEventListener('click', () => {
                    gameArea.removeChild(confirmEl);
                });
                
                document.getElementById('confirm-reset').addEventListener('click', () => {
                    gameArea.removeChild(confirmEl);
                    cleanupGame();
                    resetGameState();
                });
            }
            
            function cleanupGame() {
                gameActive = false;
                
                // æ¸…ç©ºéŠæˆ²å€åŸŸ
                clearGameArea();
            }
            
            function resetGameState() {
                resetButton.classList.add('hidden');
                resetButton.classList.remove('btn-bounce');
                startButton.classList.remove('hidden');
                restartButton.classList.add('hidden');
                timerBarContainer.classList.add('hidden');
                
                averageTimeDisplay.textContent = '0';
                roundsLeftDisplay.textContent = totalRounds;
                comboCountDisplay.textContent = '0';
                maxComboDisplay.textContent = '0';
            }
            
            function createTarget() {
                if (!gameActive) return;
                
                // å…ˆæ¸…ç©ºéŠæˆ²å€åŸŸï¼Œç¢ºä¿æ¯å›åˆé–‹å§‹æ™‚ç•«é¢æ˜¯ä¹¾æ·¨çš„
                clearGameArea();
                
                if (currentRound >= totalRounds) {
                    endGame();
                    return;
                }
                
                const settings = difficultySettings[difficulty];
                const delay = Math.floor(Math.random() * (settings.maxDelay - settings.minDelay + 1)) + settings.minDelay;
                
                timeoutId = setTimeout(() => {
                    if (!gameActive) return;
                    
                    // æ ¹æ“šå±å¹•å¤§å°èª¿æ•´ç›®æ¨™å°ºå¯¸
                    let minSize = settings.minSize;
                    let maxSize = settings.maxSize;
                    
                    // æ‰‹æ©Ÿæ¨¡å¼ä¸‹ç¢ºä¿ç›®æ¨™è¶³å¤ å¤§
                    if (window.innerWidth <= 768) {
                        minSize = Math.max(minSize, 60);
                        maxSize = Math.max(maxSize, 80);
                    }
                    
                    const size = Math.floor(Math.random() * (maxSize - minSize + 1)) + minSize;
                    const maxX = gameArea.clientWidth - size;
                    const maxY = gameArea.clientHeight - size;
                    const x = Math.floor(Math.random() * maxX);
                    const y = Math.floor(Math.random() * maxY);
                    const colorIndex = Math.floor(Math.random() * settings.colors.length);
                    
                    currentTarget = document.createElement('div');
                    currentTarget.className = 'target pop-effect';
                    
                    // æ ¹æ“šéŠæˆ²æ¨¡å¼è¨­å®šç›®æ¨™å½¢ç‹€
                    if (gameMode === 'shapes') {
                        const shapeIndex = Math.floor(Math.random() * shapeTypes.length);
                        currentTarget.classList.add(shapeTypes[shapeIndex]);
                    } else {
                        currentTarget.classList.add('target-circle');
                    }
                    
                    currentTarget.style.width = `${size}px`;
                    currentTarget.style.height = `${size}px`;
                    currentTarget.style.left = `${x}px`;
                    currentTarget.style.top = `${y}px`;
                    currentTarget.style.backgroundColor = settings.colors[colorIndex];
                    
                    // æ·»åŠ è¡¨æƒ…æˆ–åœ–æ¨™
                    if (Math.random() > 0.7) {
                        const emojis = ['ğŸ˜€', 'ğŸ˜', 'ğŸš€', 'â­', 'ğŸ¯', 'ğŸ’¥', 'ğŸ”¥', 'ğŸ‘', 'ğŸ®', 'ğŸ†'];
                        const emoji = emojis[Math.floor(Math.random() * emojis.length)];
                        currentTarget.innerHTML = `<span style="font-size: ${size/2}px">${emoji}</span>`;
                    }
                    
                    currentTarget.addEventListener('click', targetClicked);
                    
                    gameArea.appendChild(currentTarget);
                    targetAppearTime = Date.now();
                    
                    // è¨­å®šæ™‚é–“é™åˆ¶
                    resetTimerBar(settings.timeLimit);
                    
                    // å¦‚æœæ˜¯ç§»å‹•æ¨¡å¼ï¼Œè®“ç›®æ¨™ç§»å‹•
                    if (gameMode === 'moving') {
                        moveTarget(currentTarget, size);
                    }
                    
                    // è¨­å®šç›®æ¨™æ¶ˆå¤±çš„æ™‚é–“é™åˆ¶
                    targetTimeout = setTimeout(() => {
                        if (gameActive && currentTarget && currentTarget.parentNode === gameArea) {
                            missedTarget();
                        }
                    }, settings.timeLimit);
                    
                }, delay);
            }
            
            function moveTarget(target, size) {
                const speed = difficulty === 'insane' ? 5 : 
                             difficulty === 'hard' ? 3 : 
                             difficulty === 'medium' ? 2 : 1;
                
                let dirX = Math.random() > 0.5 ? speed : -speed;
                let dirY = Math.random() > 0.5 ? speed : -speed;
                
                movingInterval = setInterval(() => {
                    if (!gameActive || !target || !target.parentNode) {
                        clearInterval(movingInterval);
                        return;
                    }
                    
                    let x = parseInt(target.style.left);
                    let y = parseInt(target.style.top);
                    
                    // ç¢°åˆ°é‚Šç•Œå°±åå½ˆ
                    if (x <= 0 || x >= gameArea.clientWidth - size) {
                        dirX = -dirX;
                    }
                    if (y <= 0 || y >= gameArea.clientHeight - size) {
                        dirY = -dirY;
                    }
                    
                    target.style.left = `${x + dirX}px`;
                    target.style.top = `${y + dirY}px`;
                }, 16);
            }
            
            function resetTimerBar(timeLimit) {
                timerBar.style.width = '100%';
                timerBar.style.background = 'linear-gradient(to right, #10b981, #3b82f6)';
                
                // æ¸…é™¤ä¹‹å‰çš„è¨ˆæ™‚å™¨
                if (timerInterval) {
                    clearInterval(timerInterval);
                }
                
                // å‹•ç•«è¨ˆæ™‚å™¨
                let startTime = Date.now();
                timerInterval = setInterval(() => {
                    if (!gameActive || !currentTarget) {
                        clearInterval(timerInterval);
                        return;
                    }
                    
                    const elapsed = Date.now() - startTime;
                    const percentage = 100 - (elapsed / timeLimit * 100);
                    
                    if (percentage <= 0) {
                        clearInterval(timerInterval);
                        return;
                    }
                    
                    timerBar.style.width = `${percentage}%`;
                    
                    // æ”¹è®Šé¡è‰²
                    if (percentage < 30) {
                        timerBar.style.background = 'linear-gradient(to right, #ef4444, #f59e0b)';
                    } else if (percentage < 60) {
                        timerBar.style.background = 'linear-gradient(to right, #f59e0b, #10b981)';
                    }
                }, 16);
            }
            
            function targetClicked(e) {
                e.stopPropagation();
                
                if (!gameActive) return;
                
                const clickTime = Date.now();
                const reactionTime = clickTime - targetAppearTime;
                reactionTimes.push(reactionTime);
                
                // æ›´æ–°æœ€ä½³åæ‡‰æ™‚é–“
                if (reactionTime < bestReactionTime) {
                    bestReactionTime = reactionTime;
                    statsBest.textContent = bestReactionTime;
                    
                    // æª¢æŸ¥æˆå°±
                    if (reactionTime < 300 && !achievements.speedDemon) {
                        achievements.speedDemon = true;
                        showAchievement('é–ƒé›»æ‰‹æŒ‡', 'åæ‡‰æ™‚é–“ä½æ–¼300æ¯«ç§’ï¼');
                    }
                }
                
                // å¢åŠ é€£æ“Šæ•¸
                comboCount++;
                comboCountDisplay.textContent = comboCount;
                
                if (comboCount > maxCombo) {
                    maxCombo = comboCount;
                    maxComboDisplay.textContent = maxCombo;
                    
                    if (maxCombo > parseInt(statsCombo.textContent)) {
                        statsCombo.textContent = maxCombo;
                    }
                    
                    // æª¢æŸ¥æˆå°±
                    if (maxCombo >= 10 && !achievements.comboMaster) {
                        achievements.comboMaster = true;
                        showAchievement('é€£æ“Šå¤§å¸«', 'é”æˆ10é€£æ“Šï¼');
                    }
                }
                
                // é¡¯ç¤ºé€£æ“Šæ•ˆæœ
                showComboEffect(e.clientX, e.clientY, comboCount, reactionTime);
                
                // æ¸…é™¤ç›®æ¨™
                currentTarget.classList.add('fade-out');
                setTimeout(() => {
                    if (currentTarget && currentTarget.parentNode === gameArea) {
                        gameArea.removeChild(currentTarget);
                    }
                    currentTarget = null;
                }, 300);
                
                // æ¸…é™¤è¨ˆæ™‚å™¨
                if (targetTimeout) {
                    clearTimeout(targetTimeout);
                }
                
                if (movingInterval) {
                    clearInterval(movingInterval);
                }
                
                if (timerInterval) {
                    clearInterval(timerInterval);
                }
                
                // æ›´æ–°å›åˆ
                currentRound++;
                roundsLeftDisplay.textContent = totalRounds - currentRound;
                
                // æ›´æ–°å¹³å‡åæ‡‰æ™‚é–“
                const average = Math.round(reactionTimes.reduce((sum, time) => sum + time, 0) / reactionTimes.length);
                averageTimeDisplay.textContent = average;
                
                // æ›´æ–°çµ±è¨ˆ
                totalClicks++;
                statsClicks.textContent = totalClicks;
                saveStats();
                
                // çŸ­æš«å»¶é²å¾Œå‰µå»ºä¸‹ä¸€å€‹ç›®æ¨™ï¼Œç¢ºä¿ç•«é¢æ¸…ç©º
                setTimeout(() => {
                    createTarget();
                }, 500);
            }
            
            function missedTarget() {
                if (!gameActive) return;
                
                // ç›®æ¨™æ¶ˆå¤±æ•ˆæœ
                if (currentTarget) {
                    currentTarget.classList.add('fade-out');
                    setTimeout(() => {
                        if (currentTarget && currentTarget.parentNode === gameArea) {
                            gameArea.removeChild(currentTarget);
                        }
                        currentTarget = null;
                    }, 300);
                }
                
                // é‡ç½®é€£æ“Š
                comboCount = 0;
                comboCountDisplay.textContent = comboCount;
                
                // éœ‡å‹•æ•ˆæœ
                gameArea.classList.add('shake');
                setTimeout(() => {
                    gameArea.classList.remove('shake');
                }, 500);
                
                // æ¸…é™¤ç§»å‹•é–“éš”
                if (movingInterval) {
                    clearInterval(movingInterval);
                }
                
                if (timerInterval) {
                    clearInterval(timerInterval);
                }
                
                // æ›´æ–°å›åˆ
                currentRound++;
                roundsLeftDisplay.textContent = totalRounds - currentRound;
                
                // çŸ­æš«å»¶é²å¾Œå‰µå»ºä¸‹ä¸€å€‹ç›®æ¨™ï¼Œç¢ºä¿ç•«é¢æ¸…ç©º
                setTimeout(() => {
                    createTarget();
                }, 500);
            }
            
            function showComboEffect(x, y, combo, time) {
                const comboEl = document.createElement('div');
                comboEl.className = 'combo-indicator';
                
                // æ ¹æ“šé€£æ“Šæ•¸å’Œåæ‡‰æ™‚é–“è¨­å®šé¡è‰²å’Œå¤§å°
                let color, size, text;
                
                if (time < 400) {
                    color = '#ef4444'; // ç´…è‰² - è¶…å¿«
                    size = '24px';
                    text = `${time}ms å®Œç¾ï¼`;
                    createConfetti(x, y, 20);
                } else if (time < 600) {
                    color = '#f59e0b'; // æ©™è‰² - å¾ˆå¿«
                    size = '20px';
                    text = `${time}ms å„ªç§€ï¼`;
                } else if (time < 800) {
                    color = '#10b981'; // ç¶ è‰² - å¿«
                    size = '18px';
                    text = `${time}ms ä¸éŒ¯ï¼`;
                } else {
                    color = '#3b82f6'; // è—è‰² - ä¸€èˆ¬
                    size = '16px';
                    text = `${time}ms`;
                }
                
                // é€£æ“Šæ•ˆæœ
                if (combo >= 5) {
                    text = `${text} x${combo} é€£æ“Šï¼`;
                    if (combo >= 10) {
                        createConfetti(x, y, 30);
                    }
                }
                
                comboEl.style.color = color;
                comboEl.style.fontSize = size;
                comboEl.style.left = `${x - gameArea.getBoundingClientRect().left}px`;
                comboEl.style.top = `${y - gameArea.getBoundingClientRect().top}px`;
                comboEl.textContent = text;
                
                gameArea.appendChild(comboEl);
                
                setTimeout(() => {
                    if (comboEl.parentNode === gameArea) {
                        gameArea.removeChild(comboEl);
                    }
                }, 800);
            }
            
            function createConfetti(x, y, amount) {
                const colors = ['#ef4444', '#f59e0b', '#10b981', '#3b82f6', '#8b5cf6', '#ec4899'];
                
                for (let i = 0; i < amount; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    
                    const size = Math.random() * 8 + 6;
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    
                    confetti.style.width = `${size}px`;
                    confetti.style.height = `${size}px`;
                    confetti.style.backgroundColor = color;
                    confetti.style.left = `${x - gameArea.getBoundingClientRect().left}px`;
                    confetti.style.top = `${y - gameArea.getBoundingClientRect().top}px`;
                    confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                    
                    gameArea.appendChild(confetti);
                    
                    // éš¨æ©Ÿå‹•ç•«
                    const angle = Math.random() * Math.PI * 2;
                    const velocity = Math.random() * 5 + 5;
                    const vx = Math.cos(angle) * velocity;
                    const vy = Math.sin(angle) * velocity;
                    let posX = x - gameArea.getBoundingClientRect().left;
                    let posY = y - gameArea.getBoundingClientRect().top;
                    
                    const animate = () => {
                        if (!gameActive) {
                            if (confetti.parentNode === gameArea) {
                                gameArea.removeChild(confetti);
                            }
                            return;
                        }
                        
                        posX += vx;
                        posY += vy + 0.5; // åŠ ä¸Šé‡åŠ›
                        
                        confetti.style.left = `${posX}px`;
                        confetti.style.top = `${posY}px`;
                        confetti.style.opacity = confetti.style.opacity ? parseFloat(confetti.style.opacity) - 0.02 : 1;
                        
                        if (parseFloat(confetti.style.opacity) > 0 && 
                            posX > 0 && posX < gameArea.clientWidth && 
                            posY > 0 && posY < gameArea.clientHeight) {
                            requestAnimationFrame(animate);
                        } else {
                            if (confetti.parentNode === gameArea) {
                                gameArea.removeChild(confetti);
                            }
                        }
                    };
                    
                    requestAnimationFrame(animate);
                }
            }
            
            function endGame() {
                gameActive = false;
                
                // æ¸…ç©ºéŠæˆ²å€åŸŸ
                clearGameArea();
                
                timerBarContainer.classList.add('hidden');
                resetButton.classList.add('hidden');
                resetButton.classList.remove('btn-bounce');
                
                const average = Math.round(reactionTimes.reduce((sum, time) => sum + time, 0) / reactionTimes.length);
                const best = Math.min(...reactionTimes);
                
                bestTimeDisplay.textContent = best;
                
                // æª¢æŸ¥æ˜¯å¦ç‚ºå®Œç¾éŠæˆ²
                if (reactionTimes.length === totalRounds && !achievements.perfectGame) {
                    achievements.perfectGame = true;
                    showAchievement('å®Œç¾éŠæˆ²', 'å®Œæˆæ‰€æœ‰å›åˆä¸”æ²’æœ‰éŒ¯éä»»ä½•ç›®æ¨™ï¼');
                }
                
                // æ›´æ–°æ’è¡Œæ¦œ
                const now = new Date();
                const timeString = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
                
                leaderboardData.push({
                    time: timeString,
                    average: average,
                    best: best,
                    difficulty: difficulty,
                    mode: gameMode,
                    combo: maxCombo
                });
                
                leaderboardData.sort((a, b) => a.average - b.average);
                if (leaderboardData.length > 10) {
                    leaderboardData = leaderboardData.slice(0, 10);
                }
                
                updateLeaderboard();
                
                restartButton.classList.remove('hidden');
                
                // é¡¯ç¤ºçµæœ
                showResults(average, best, maxCombo);
            }
            
            function showResults(average, best, combo) {
                const resultEl = document.createElement('div');
                resultEl.className = 'absolute inset-0 flex items-center justify-center flex-col bg-black bg-opacity-70 rounded-2xl z-20';
                
                let rank, message;
                if (average < 500) {
                    rank = 'é–ƒé›»åæ‡‰';
                    message = 'ä½ çš„åæ‡‰é€Ÿåº¦ä»¤äººé›£ä»¥ç½®ä¿¡ï¼';
                } else if (average < 700) {
                    rank = 'è¶…ç´šå¿«æ‰‹';
                    message = 'ä½ çš„åæ‡‰èƒ½åŠ›éå¸¸å‡ºè‰²ï¼';
                } else if (average < 900) {
                    rank = 'åæ‡‰é”äºº';
                    message = 'ä½ æœ‰å¾ˆå¥½çš„åæ‡‰èƒ½åŠ›ï¼';
                } else {
                    rank = 'è¦‹ç¿’è€…';
                    message = 'ç¹¼çºŒç·´ç¿’ï¼Œä½ æœƒè®Šå¾—æ›´å¿«ï¼';
                }
                
                resultEl.innerHTML = `
                    <div class="text-center p-6 bg-white bg-opacity-95 rounded-xl shadow-lg max-w-md w-11/12">
                        <h2 class="text-3xl font-bold text-indigo-600 mb-2">éŠæˆ²çµæŸï¼</h2>
                        <p class="text-xl font-bold text-purple-600 mb-4">${rank}</p>
                        <p class="text-gray-600 mb-4">${message}</p>
                        <div class="grid grid-cols-3 gap-3 mb-4">
                            <div class="bg-indigo-100 p-3 rounded-lg">
                                <p class="text-gray-500 text-sm">å¹³å‡åæ‡‰</p>
                                <p class="font-bold text-xl text-indigo-600">${average} ms</p>
                            </div>
                            <div class="bg-purple-100 p-3 rounded-lg">
                                <p class="text-gray-500 text-sm">æœ€ä½³åæ‡‰</p>
                                <p class="font-bold text-xl text-purple-600">${best} ms</p>
                            </div>
                            <div class="bg-pink-100 p-3 rounded-lg">
                                <p class="text-gray-500 text-sm">æœ€é«˜é€£æ“Š</p>
                                <p class="font-bold text-xl text-pink-600">${combo}</p>
                            </div>
                        </div>
                        <div class="flex gap-3 justify-center">
                            <button id="close-results" class="bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-bold py-2 px-6 rounded-lg shadow transition">
                                é—œé–‰
                            </button>
                            <button id="change-mode" class="bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 text-white font-bold py-2 px-6 rounded-lg shadow transition">
                                æ›´æ›æ¨¡å¼
                            </button>
                        </div>
                    </div>
                `;
                
                gameArea.appendChild(resultEl);
                
                document.getElementById('close-results').addEventListener('click', () => {
                    gameArea.removeChild(resultEl);
                });
                
                document.getElementById('change-mode').addEventListener('click', () => {
                    gameArea.removeChild(resultEl);
                    resetGameState();
                });
                
                // å‰µå»ºæˆå°±æ•ˆæœ
                createConfetti(
                    gameArea.getBoundingClientRect().left + gameArea.clientWidth / 2, 
                    gameArea.getBoundingClientRect().top + gameArea.clientHeight / 2, 
                    50
                );
            }
            
            function updateLeaderboard() {
                if (leaderboardData.length === 0) {
                    leaderboard.innerHTML = '<p class="text-gray-500 text-center">å°šç„¡è¨˜éŒ„</p>';
                    return;
                }
                
                leaderboard.innerHTML = '';
                
                leaderboardData.forEach((entry, index) => {
                    const item = document.createElement('div');
                    item.className = 'leaderboard-item flex justify-between items-center bg-white p-3 rounded-lg shadow-sm';
                    
                    const difficultyLabel = {
                        'easy': 'ç°¡å–®',
                        'medium': 'ä¸­ç­‰',
                        'hard': 'å›°é›£',
                        'insane': 'ç˜‹ç‹‚'
                    }[entry.difficulty];
                    
                    const modeLabel = {
                        'standard': 'æ¨™æº–',
                        'shapes': 'å½¢ç‹€',
                        'moving': 'ç§»å‹•'
                    }[entry.mode];
                    
                    // å‰ä¸‰åæœ‰ç‰¹æ®Šæ¨™è¨˜
                    let rankIcon = `<span class="font-bold text-indigo-600 w-6">${index + 1}.</span>`;
                    if (index === 0) {
                        rankIcon = '<span class="text-yellow-500 text-xl">ğŸ¥‡</span>';
                    } else if (index === 1) {
                        rankIcon = '<span class="text-gray-400 text-xl">ğŸ¥ˆ</span>';
                    } else if (index === 2) {
                        rankIcon = '<span class="text-amber-700 text-xl">ğŸ¥‰</span>';
                    }
                    
                    // æ‰‹æ©Ÿæ¨¡å¼ä¸‹ç°¡åŒ–é¡¯ç¤º
                    if (window.innerWidth <= 768) {
                        item.innerHTML = `
                            <div class="flex items-center">
                                ${rankIcon}
                                <span class="ml-2">${entry.time}</span>
                                <div class="ml-2">
                                    <span class="px-1 py-0.5 bg-indigo-100 text-indigo-800 text-xs rounded-full">${difficultyLabel}</span>
                                </div>
                            </div>
                            <div>
                                <span class="text-gray-600 text-sm">${entry.average}ms</span>
                            </div>
                        `;
                    } else {
                        item.innerHTML = `
                            <div class="flex items-center">
                                ${rankIcon}
                                <span class="ml-2">${entry.time}</span>
                                <div class="ml-3 flex gap-1">
                                    <span class="px-2 py-1 bg-indigo-100 text-indigo-800 text-xs rounded-full">${difficultyLabel}</span>
                                    <span class="px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded-full">${modeLabel}</span>
                                </div>
                            </div>
                            <div>
                                <span class="text-gray-600 text-sm">å¹³å‡: <span class="font-bold">${entry.average}</span> ms</span>
                                <span class="ml-2 text-gray-600 text-sm">æœ€ä½³: <span class="font-bold">${entry.best}</span> ms</span>
                            </div>
                        `;
                    }
                    
                    leaderboard.appendChild(item);
                });
            }
            
            function showAchievement(title, description) {
                const achievementEl = document.createElement('div');
                achievementEl.className = 'achievement';
                achievementEl.innerHTML = `
                    <div class="flex items-center">
                        <div class="mr-3 text-2xl">ğŸ†</div>
                        <div>
                            <h3 class="font-bold text-indigo-600">${title}</h3>
                            <p class="text-sm text-gray-600">${description}</p>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(achievementEl);
                
                setTimeout(() => {
                    if (document.body.contains(achievementEl)) {
                        document.body.removeChild(achievementEl);
                    }
                }, 4500);
            }
            
            function saveStats() {
                const stats = {
                    bestTime: bestReactionTime === Infinity ? 0 : bestReactionTime,
                    maxCombo: maxCombo,
                    totalGames: totalGames,
                    totalClicks: totalClicks,
                    achievements: achievements
                };
                
                localStorage.setItem('reactionGameStats', JSON.stringify(stats));
            }
            
            function loadStats() {
                const savedStats = localStorage.getItem('reactionGameStats');
                if (savedStats) {
                    const stats = JSON.parse(savedStats);
                    bestReactionTime = stats.bestTime || Infinity;
                    maxCombo = stats.maxCombo || 0;
                    totalGames = stats.totalGames || 0;
                    totalClicks = stats.totalClicks || 0;
                    achievements = stats.achievements || {
                        speedDemon: false,
                        comboMaster: false,
                        perfectGame: false
                    };
                    
                    statsBest.textContent = bestReactionTime === Infinity ? '-' : bestReactionTime;
                    statsCombo.textContent = maxCombo;
                    statsGames.textContent = totalGames;
                    statsClicks.textContent = totalClicks;
                }
            }
            
            // é»æ“ŠéŠæˆ²å€åŸŸå¤–çš„ç›®æ¨™
            gameArea.addEventListener('click', (e) => {
                if (gameActive && e.target === gameArea && currentTarget) {
                    // é‡ç½®é€£æ“Š
                    comboCount = 0;
                    comboCountDisplay.textContent = comboCount;
                }
            });
            
            // ç›£è½å±å¹•å¤§å°è®ŠåŒ–ï¼Œèª¿æ•´éŠæˆ²å€åŸŸ
            window.addEventListener('resize', () => {
                // å¦‚æœæœ‰æ­£åœ¨é€²è¡Œçš„éŠæˆ²ï¼Œä¸åšèª¿æ•´
                if (gameActive) return;
                
                // èª¿æ•´é›£åº¦è¨­å®šä¸­çš„ç›®æ¨™å¤§å°
                if (window.innerWidth <= 768) {
                    Object.keys(difficultySettings).forEach(key => {
                        // ç¢ºä¿æ‰‹æ©Ÿæ¨¡å¼ä¸‹ç›®æ¨™è¶³å¤ å¤§
                        difficultySettings[key].minSize = Math.max(difficultySettings[key].minSize, 60);
                        difficultySettings[key].maxSize = Math.max(difficultySettings[key].maxSize, 80);
                    });
                }
            });
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'95ac057833baf209',t:'MTc1MTc3MjYwNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
